<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com https://www.gstatic.com; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net; img-src 'self' data: blob:; connect-src 'self';">
    <title>æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ - ãƒã‚¹ãƒã‚¸ï¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-8">
    <div class="container mx-auto max-w-6xl">
        <h1 class="text-4xl font-bold text-white text-center mb-8">ğŸ® ãƒã‚¹ãƒã‚¸ï¼æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆ</h1>

        <!-- ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ -->
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-white mb-4">ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-green-500/20 rounded-lg p-4 text-center">
                    <div class="text-3xl font-bold text-green-300" id="passCount">0</div>
                    <div class="text-sm text-white">åˆæ ¼</div>
                </div>
                <div class="bg-red-500/20 rounded-lg p-4 text-center">
                    <div class="text-3xl font-bold text-red-300" id="failCount">0</div>
                    <div class="text-sm text-white">å¤±æ•—</div>
                </div>
                <div class="bg-yellow-500/20 rounded-lg p-4 text-center">
                    <div class="text-3xl font-bold text-yellow-300" id="warnCount">0</div>
                    <div class="text-sm text-white">è­¦å‘Š</div>
                </div>
                <div class="bg-blue-500/20 rounded-lg p-4 text-center">
                    <div class="text-3xl font-bold text-blue-300" id="totalCount">0</div>
                    <div class="text-sm text-white">åˆè¨ˆ</div>
                </div>
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆé …ç›® -->
        <div class="space-y-4" id="testResults">
            <!-- ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ -->
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 mt-6">
            <h2 class="text-2xl font-bold text-white mb-4">ğŸ”— ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <a href="index.html" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded text-center">
                    ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸
                </a>
                <a href="player-create.html" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded text-center">
                    ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
                </a>
                <a href="world-map.html" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded text-center">
                    ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—
                </a>
                <a href="settings.html" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded text-center">
                    è¨­å®š
                </a>
                <a href="shop.html" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 px-4 rounded text-center">
                    ã‚·ãƒ§ãƒƒãƒ—
                </a>
                <a href="inventory.html" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded text-center">
                    ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª
                </a>
            </div>
        </div>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="js/main.js"></script>
    <script src="js/player.js"></script>
    <script src="js/worlds.js"></script>
    <script>
        const tests = [];
        let passCount = 0;
        let failCount = 0;
        let warnCount = 0;

        function addTest(category, name, status, message = '') {
            tests.push({ category, name, status, message });
            if (status === 'pass') passCount++;
            else if (status === 'fail') failCount++;
            else if (status === 'warn') warnCount++;
        }

        function runTests() {
            console.log('ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...');

            // 1. JavaScriptãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
            addTest('Core', 'main.js èª­ã¿è¾¼ã¿', typeof MathMagic !== 'undefined' ? 'pass' : 'fail',
                typeof MathMagic !== 'undefined' ? 'MathMagicã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™' : 'MathMagicãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

            addTest('Core', 'player.js èª­ã¿è¾¼ã¿', typeof PlayerManager !== 'undefined' ? 'pass' : 'fail',
                typeof PlayerManager !== 'undefined' ? 'PlayerManagerãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™' : 'PlayerManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

            addTest('Core', 'worlds.js èª­ã¿è¾¼ã¿', typeof WORLD_DATA !== 'undefined' ? 'pass' : 'fail',
                typeof WORLD_DATA !== 'undefined' ? 'WORLD_DATAãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™' : 'WORLD_DATAãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

            // 2. ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
            if (typeof WORLD_DATA !== 'undefined') {
                const worldCount = Object.keys(WORLD_DATA).length;
                addTest('Data', 'ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿', worldCount === 9 ? 'pass' : 'warn',
                    `${worldCount}å­¦å¹´åˆ†ã®ãƒ‡ãƒ¼ã‚¿ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼ˆæœŸå¾…: 9ï¼‰`);

                // ã‚¯ã‚¨ã‚¹ãƒˆæ•°ãƒã‚§ãƒƒã‚¯
                let totalQuests = 0;
                Object.values(WORLD_DATA).forEach(world => {
                    totalQuests += world.quests.length;
                });
                addTest('Data', 'ã‚¯ã‚¨ã‚¹ãƒˆç·æ•°', totalQuests === 180 ? 'pass' : 'warn',
                    `${totalQuests}ã‚¯ã‚¨ã‚¹ãƒˆï¼ˆæœŸå¾…: 180ï¼‰`);
            }

            // 3. LocalStorageæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
            try {
                localStorage.setItem('test_key', 'test_value');
                const value = localStorage.getItem('test_key');
                localStorage.removeItem('test_key');
                addTest('Storage', 'LocalStorage', value === 'test_value' ? 'pass' : 'fail',
                    'LocalStorageãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã™');
            } catch (e) {
                addTest('Storage', 'LocalStorage', 'fail', `ã‚¨ãƒ©ãƒ¼: ${e.message}`);
            }

            // 4. CSSèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
            const cssLink = document.querySelector('link[href="css/style.css"]');
            addTest('Assets', 'CSSãƒ•ã‚¡ã‚¤ãƒ«', cssLink !== null ? 'pass' : 'warn',
                cssLink ? 'style.cssãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™' : 'style.cssãƒªãƒ³ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');

            // 5. ç”»åƒã‚¢ã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆå­˜åœ¨ç¢ºèªï¼‰
            const testImage = new Image();
            testImage.onload = () => {
                addTest('Assets', 'èƒŒæ™¯ç”»åƒ', 'pass', 'fantasy-landscape.jpgãŒèª­ã¿è¾¼ã‚ã¾ã™');
                displayResults();
            };
            testImage.onerror = () => {
                addTest('Assets', 'èƒŒæ™¯ç”»åƒ', 'warn', 'fantasy-landscape.jpgãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                displayResults();
            };
            testImage.src = 'assets/images/backgrounds/fantasy-landscape.jpg';

            // 6. PWA Manifest ãƒ†ã‚¹ãƒˆ
            fetch('./manifest.json')
                .then(response => response.json())
                .then(data => {
                    addTest('PWA', 'Manifest.json', 'pass', `ã‚¢ãƒ—ãƒªå: ${data.short_name}`);
                    displayResults();
                })
                .catch(error => {
                    addTest('PWA', 'Manifest.json', 'warn', `èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    displayResults();
                });

            // 7. Service Worker ãƒ†ã‚¹ãƒˆ
            if ('serviceWorker' in navigator) {
                addTest('PWA', 'Service Workerå¯¾å¿œ', 'pass', 'ãƒ–ãƒ©ã‚¦ã‚¶ãŒService Workerã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™');
            } else {
                addTest('PWA', 'Service Workerå¯¾å¿œ', 'warn', 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯Service Workerã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
            }

            // 8. ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ
            const storyFiles = ['grade1', 'grade2', 'grade3', 'grade4', 'grade5', 'grade6', 'jh1', 'jh2', 'jh3'];
            let storyLoadCount = 0;
            storyFiles.forEach(grade => {
                fetch(`js/stories/${grade}-story.json`)
                    .then(response => response.json())
                    .then(data => {
                        storyLoadCount++;
                        if (storyLoadCount === 1) {
                            addTest('Story', 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«', 'pass', `${storyFiles.length}å­¦å¹´åˆ†ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒç¢ºèªã§ãã¾ã™`);
                            displayResults();
                        }
                    })
                    .catch(() => {
                        addTest('Story', 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«', 'warn', `${grade}-story.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                        displayResults();
                    });
            });

            // åˆå›çµæœè¡¨ç¤ºï¼ˆåŒæœŸãƒ†ã‚¹ãƒˆã®ã¿ï¼‰
            setTimeout(() => displayResults(), 100);
        }

        function displayResults() {
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const categories = {};
            tests.forEach(test => {
                if (!categories[test.category]) {
                    categories[test.category] = [];
                }
                categories[test.category].push(test);
            });

            // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«è¡¨ç¤º
            Object.entries(categories).forEach(([category, categoryTests]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'bg-white/10 backdrop-blur-sm rounded-lg p-6';

                categoryDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-white mb-4">${getCategoryIcon(category)} ${category}</h3>
                    <div class="space-y-2">
                        ${categoryTests.map(test => `
                            <div class="flex items-start gap-3 p-3 bg-black/20 rounded">
                                <div class="text-2xl">${getStatusIcon(test.status)}</div>
                                <div class="flex-1">
                                    <div class="font-bold text-white">${test.name}</div>
                                    ${test.message ? `<div class="text-sm text-gray-300">${test.message}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                resultsContainer.appendChild(categoryDiv);
            });

            // ã‚µãƒãƒªãƒ¼æ›´æ–°
            document.getElementById('passCount').textContent = passCount;
            document.getElementById('failCount').textContent = failCount;
            document.getElementById('warnCount').textContent = warnCount;
            document.getElementById('totalCount').textContent = tests.length;
        }

        function getCategoryIcon(category) {
            const icons = {
                'Core': 'âš™ï¸',
                'Data': 'ğŸ“š',
                'Storage': 'ğŸ’¾',
                'Assets': 'ğŸ–¼ï¸',
                'PWA': 'ğŸ“±',
                'Story': 'ğŸ“–'
            };
            return icons[category] || 'ğŸ“‹';
        }

        function getStatusIcon(status) {
            return status === 'pass' ? 'âœ…' : status === 'fail' ? 'âŒ' : 'âš ï¸';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
