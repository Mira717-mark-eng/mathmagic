# マスマジ！～魔法数学冒険記～

RPG風教育ゲームで楽しく算数・数学を学ぶ、小学生・中学生向けの学習アプリです。

## 🎮 プロジェクト概要

**コンセプト**: ゲーム性を最優先し、勉強感を出さずに数学を学べるRPG

**対象**: 家族利用（小学生2人、中学生1人、保護者1人）

**技術スタック**:
- 静的サイト（HTML/CSS/JavaScript）
- Tailwind CSS
- OpenAI GPT-4o-mini API
- Netlify Functions（サーバーレス）
- PWA対応

---

## ✨ 実装済み機能（Phase 2完了）

### 基本機能
- ✅ プレイヤー作成（名前、学年、キャラクター選択）
- ✅ ワールドマップ（学年別フィルタリング）
- ✅ クエスト画面（問題表示、回答入力）
- ✅ 結果画面（正解判定、経験値獲得、レベルアップ）
- ✅ 経験値・レベルシステム
- ✅ プレイヤーデータ永続化（LocalStorage）

### Phase 2新機能
- ✅ **AI問題生成**（GPT-4o-mini使用）
- ✅ **リトライ機能**（不正解時に答えを見せない）
- ✅ **3段階ヒントシステム**（任意、経験値減少ペナルティ）
- ✅ **AI解説表示**（正解後に詳しい説明）
- ✅ **図形描画機能**（Canvas/SVG）
- ✅ **複数ワールド対応**（学年別フィルタリング）
- ✅ **保護者ダッシュボード**（3人の進捗統計）
- ✅ **PWA対応**（ホーム画面に追加可能）
- ✅ **レスポンシブデザイン**（スマホ・タブレット・PC対応）

### 教育的特徴
- ✅ **文部科学省学習指導要領に準拠**
- ✅ **主要学習塾カリキュラム参考**（公文、学研、栄光）
- ✅ **学年別ワールド自動表示**
- ✅ **無限バリエーション問題**（AI生成）

---

## 🗺️ 実装済みワールド

### 小学2年生〜4年生
- 🌲 **掛け算の森** - 九九（2桁×1桁）

### 小学3年生〜5年生
- ⛰️ **割り算の洞窟** - 割り算（2桁÷1桁）

### 小学4年生〜6年生
- 🗼 **分数の塔** - 分数の計算
- 🌊 **小数の海** - 小数の計算

### 小学5年生〜中学1年生
- 🏛️ **面積の広場** - 面積計算（長方形、三角形）

> 追加ワールドは `js/worlds.js` で簡単に実装できます

---

## 📁 ファイル構造

```
mathmagic/
├── index.html                    # トップ画面
├── player-create.html            # プレイヤー作成画面
├── world-map.html                # ワールドマップ
├── quest.html                    # クエスト画面
├── result.html                   # 結果画面
├── parent-dashboard.html         # 保護者ダッシュボード
├── manifest.json                 # PWA manifest
├── service-worker.js             # Service Worker
├── netlify.toml                  # Netlify設定
├── .env.example                  # 環境変数テンプレート
│
├── css/
│   └── style.css                 # カスタムCSS
│
├── js/
│   ├── main.js                   # 共通関数
│   ├── player.js                 # プレイヤー管理
│   ├── world-map.js              # ワールドマップ処理
│   ├── quest.js                  # クエスト処理（AI統合）
│   ├── result.js                 # 結果処理（AI解説）
│   ├── worlds.js                 # ワールドデータベース
│   ├── figure-drawer.js          # 図形描画
│   ├── hint-system.js            # ヒントシステム
│   └── parent-stats.js           # 保護者ダッシュボード
│
└── netlify/functions/
    ├── generate-problem.js       # AI問題生成
    ├── generate-hint.js          # AIヒント生成
    └── generate-explanation.js   # AI解説生成
```

---

## 🚀 セットアップ方法

詳細は **[SETUP_GUIDE.md](./SETUP_GUIDE.md)** を参照してください。

### 簡易手順

1. **OpenAI APIキーを取得**
   - https://platform.openai.com/signup
   - APIキーを作成（$5/月の利用上限推奨）

2. **Netlifyアカウントを作成**
   - https://app.netlify.com/signup

3. **デプロイ**
   - GitHub経由または手動デプロイ
   - Netlify Functions directoryを `netlify/functions` に設定

4. **環境変数を設定**
   - Netlifyダッシュボードで `OPENAI_API_KEY` を設定

5. **動作確認**
   - サイトにアクセスしてプレイヤー作成
   - AI問題生成をテスト

---

## 💰 コスト見積もり

### OpenAI API（GPT-4o-mini）
- **1問生成**: 約0.13円
- **家族3人、1日10問**: 約39円/月
- **非常に安価！**

### Netlify
- **無料プラン**: 月300分ビルド時間、100GB帯域幅
- **家族利用**: 完全無料

**合計**: 約40円/月

---

## 🎯 Phase 3計画（今後の拡張）

### 1. ワールド拡充
- [ ] 40種類のワールドを実装（学年別）
- [ ] 各ワールド10問 = 400問以上

### 2. ゲーム要素強化
- [ ] アイテムシステム
- [ ] キャラクター育成
- [ ] アバターカスタマイズ

### 3. UI/UX改善
- [ ] 効果音・BGM
- [ ] アニメーション強化
- [ ] キャラクターイラスト

### 4. 分析機能
- [ ] 苦手分野分析
- [ ] 学習履歴グラフ
- [ ] 推奨ワールド提案

### 5. ソーシャル機能
- [ ] 家族内ランキング
- [ ] 成果バッジシステム
- [ ] 達成シェア機能

---

## 📚 ドキュメント

- **[SETUP_GUIDE.md](./SETUP_GUIDE.md)** - セットアップ手順
- **[CURRICULUM_RESEARCH.md](./CURRICULUM_RESEARCH.md)** - 教育カリキュラム調査
- **[WORLD_DESIGN.md](./WORLD_DESIGN.md)** - ワールド設計書
- **[PHASE2_PLAN.md](./PHASE2_PLAN.md)** - Phase 2実装計画
- **[REDESIGN_SUMMARY.md](./REDESIGN_SUMMARY.md)** - 再設計まとめ

---

## 🔧 技術詳細

### AI問題生成
- **API**: OpenAI GPT-4o-mini
- **機能**: 問題文、ストーリー、答え、ヒント、解説を生成
- **フォールバック**: AI失敗時は固定問題を使用

### 図形描画
- **技術**: HTML5 Canvas API
- **対応**: 長方形、正方形、円、三角形、L字型
- **機能**: 寸法ラベル、High DPI対応

### ヒントシステム
- **段階**: 3段階（方向性 → 手順 → ほぼ答え）
- **ペナルティ**: 100% → 80% → 60% → 40%
- **確認**: ヒント表示前に確認ダイアログ

### リトライ機能
- **方針**: 不正解時に答えを見せない
- **メッセージ**: 「惜しい！もう一度考えてみよう」
- **回数**: 無制限（3回後にヒント推奨）

### PWA機能
- **オフライン**: Service Workerでキャッシュ
- **インストール**: ホーム画面に追加可能
- **体験**: ネイティブアプリのような操作感

---

## 🎓 教育的配慮

### 文部科学省学習指導要領準拠
- 小学1年〜中学3年の算数・数学カリキュラム
- 各学年の到達目標に合わせたワールド設計

### 主要学習塾カリキュラム参考
- 公文式、学研、栄光ゼミナールの教材分析
- 実績ある学習順序を採用

### ゲーミフィケーション
- 勉強感を排除したRPG風デザイン
- 達成感を重視した経験値・レベルシステム
- ストーリーで問題を魅力的に演出

---

## ⚠️ 注意事項

1. **家族利用専用**
   - 商用利用不可
   - 第三者への公開不可

2. **APIキー管理**
   - `.env` ファイルをGitにコミットしない
   - Netlify環境変数を使用

3. **利用上限設定**
   - OpenAIで月額上限を設定（$5推奨）
   - 予期しない課金を防ぐ

4. **データ保存**
   - LocalStorageに保存（ブラウザローカル）
   - ブラウザキャッシュクリアでデータ消失注意

---

## 🐛 トラブルシューティング

問題が発生した場合は **[SETUP_GUIDE.md](./SETUP_GUIDE.md)** のトラブルシューティングセクションを参照してください。

---

## 📝 ライセンス

このプロジェクトは家族利用のみを目的としています。商用利用は禁止です。

---

## 🙏 クレジット

- **UI Framework**: Tailwind CSS
- **Icons**: Font Awesome
- **AI**: OpenAI GPT-4o-mini
- **Hosting**: Netlify
- **Charts**: Chart.js

---

## 📞 サポート

ご質問やバグ報告は、ブラウザのコンソール（F12）でエラーを確認の上、お問い合わせください。

Happy Learning! 🎓✨

---

**最終更新**: 2024年11月（Phase 2完了）
