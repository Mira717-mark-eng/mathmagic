# マスマジ！（MathMagic） 🎮✨

小学1年生～中学3年生向けの **RPG型算数・数学学習アプリ**

算数・数学の問題を解いてモンスターを倒し、経験値を得てレベルアップする学習ゲームです。

## 🌟 主な機能

### 1. キャラクター作成
- **性格診断**: 5つの質問であなたに最適なキャラクターを診断
- **4つのキャラクタータイプ**: 魔法使い、騎士、アーチャー、ヒーラー
- **アバターカスタマイズ**: 8種類のアクセサリーから選択可能

### 2. ワールドマップ
- **9学年対応**: 小学1年～中学3年
- **180クエスト**: 各学年20クエスト × 9学年
- **カリキュラム準拠**: 学習指導要領に基づいた単元配置
- **進捗表示**: クリア済み・星評価・スコアが一目でわかる

### 3. バトルシステム
- **リアルタイムバトル**: 問題を解いてモンスターを攻撃
- **コンボシステム**: 連続正解でダメージアップ（最大2倍）
- **クリティカルヒット**: 5の倍数コンボで1.5倍ダメージ
- **豪華なエフェクト**:
  - キャラクター別攻撃エフェクト（魔法、斬撃、矢、回復）
  - ダメージ数値表示
  - パーティクルエフェクト
  - 画面シェイク
  - 勝利/敗北演出

### 4. 学習管理システム
- **進捗トラッキング**: クエストごとの完了状況・スコア・星評価
- **学習統計**:
  - 累計学習時間
  - 学習カレンダー（30日間）
  - 単元別正答率
  - 得意・苦手分野の分析
- **経験値システム**: 問題を解いてレベルアップ
- **ゴールド**: クエストクリアで獲得、ショップで使用

### 5. 適応学習
- **難易度自動調整**: 正答率に応じて問題の難易度を変更
- **問題順序最適化**: 理解度に基づいて出題順を調整
- **ヒント表示**: 適切なタイミングでヒントを提供
- **間隔反復学習**: 習熟度に応じた復習スケジュール

### 6. 報酬システム
- **実績・バッジ**: 10種類以上の実績
- **称号**: パーフェクトクリアや連続学習で獲得
- **アイテム**: パーフェクトメダルなど特別報酬
- **レベルアップエフェクト**: 豪華な演出

### 7. マルチプレイヤー機能
- **ローカルランキング**: デバイス内の複数プレイヤーで競争
- **ランキングメトリック**: レベル、正答率、問題数、クエスト達成数
- **グローバルランキング**: シミュレーション機能（100位まで）

### 8. カスタム問題作成
- **保護者・教師向け**: オリジナル問題を作成
- **問題管理**: 作成、編集、削除
- **カスタムクエスト**: 複数の問題をまとめてクエスト化
- **インポート/エクスポート**: JSON形式でデータ共有

### 9. 保護者ダッシュボード
- **学習統計の可視化**: グラフとチャート
- **子供の進捗確認**: クエスト達成状況
- **強み・弱み分析**: 単元別の理解度
- **学習推奨**: AIによる次の学習提案
- **データバックアップ**: JSONエクスポート/インポート

## 📚 問題データ

**180/180クエスト (100%)** の問題ファイルが配置済み ✅

全9学年（小1～中3）× 各20クエスト = 合計180クエスト完備

問題ファイル検証:
```
node validate-problems.js
```

詳細なファイル名定義: [docs/quest-file-naming.md](docs/quest-file-naming.md)

## 📊 テスト

依存関係テストを実行：
```
test-dependencies.html をブラウザで開く
```

## 📖 ストーリーシステム

**RPG風ストーリー実装済み！** 🎭

各クエストに物語が追加され、学習がより楽しくなります：

### 実装済みストーリー（全9学年）✅

- **小学1年**: 「数の王国の冒険」- 10までの数とたし算・ひき算で王国を救う
- **小学2年**: 「数の森の守護者たち」- 九九と筆算で森を救う協力の物語
- **小学3年**: 「わり算の山脈と分数の秘密」- わり算・分数・小数の新世界
- **小学4年**: 「億兆の宇宙と図形の秘密」- 大きな数と図形の謎を解く冒険
- **小学5年**: 「小数・分数の極意と速さの世界」- 割合と速さの奥義を学ぶ
- **小学6年**: 「小学算数の完成と中学への扉」- 分数・比・比例で世界の法則を理解
- **中学1年**: 「数理世界の守護者」- 正と負の世界のバランスを取り戻す
- **中学2年**: 「連立方程式と証明の試練」- 2つの未知数と論理の証明
- **中学3年**: 「中学数学の完成」- 二次方程式・相似・三平方の定理で完成へ

### 機能

- 📖 クエスト開始前のストーリーイントロ
- 🎉 クエスト完了後のストーリーアウトロ
- 👥 NPCキャラクターの登場
- 📚 章ごとのストーリー展開
- 🎭 プレイヤーキャラクターの統合

詳細: [docs/story-system-guide.md](docs/story-system-guide.md)

## 🔄 バージョン履歴

### v2.2.0 Beta (2025-01-13) - βテスト版
- ✨ 全180クエストファイル完成（小1～中3、各学年20クエスト）
- 📖 全9学年のストーリー完成（RPG風の冒険物語）
- 🎨 GeometryGeneratorとquest.jsの統合（動的図形問題生成）
- 📊 ワールドマップ進捗表示完全実装
- ✅ 全JavaScriptファイル構文検証完了
- ✅ 全JSONファイル検証完了
- 🎮 βテスト可能な状態へ

### v2.1.0 (2025-01-11)
- ✨ ストーリーシステム実装
- 📖 中学1年・小学4年・小学2年のストーリー完成
- 🎭 クエスト開始前後のストーリー表示
- 👥 NPCキャラクター・章構成の実装

### v2.0.0 (2025-01-11)
- ✨ バトルエフェクトシステム実装
- ✨ 進捗トラッキングシステム実装
- ✨ 学習統計ダッシュボード実装
- ✨ 適応学習システム実装
- ✨ マルチプレイヤー機能実装
- ✨ カスタム問題作成機能実装
- ✨ 性格診断によるキャラクター推薦
- ✨ アバターカスタマイズ
- 🎨 コンボ・クリティカルヒット演出
- 🎉 勝利・敗北・レベルアップエフェクト
- 🧹 不要ファイル削除（character-select.html等）
- ✅ 依存関係テスト追加
- 📚 問題ファイル103/103個配置（100%完成）✅
- 🔧 問題ファイル互換性対応（totalProblems/problemCount/quest_name）

## 🔧 トラブルシューティング

### エラーが表示される場合

#### CSPエラーや404エラーが出る場合
1. **ブラウザのキャッシュをクリア**
   - Windows: `Ctrl` + `Shift` + `Delete`
   - Mac: `Cmd` + `Shift` + `Delete`

2. **強制リロード**
   - Windows: `Ctrl` + `Shift` + `R`
   - Mac: `Cmd` + `Shift` + `R`

3. **キャッシュクリアツールを使用**
   ```
   clear-cache.html を開く
   ```

#### character-select.html が見つからないエラー
このファイルは削除されています。キャッシュをクリアすることで解決します。

#### Service Worker や Manifest のエラー
最新版ではパスが修正されています。ブラウザのキャッシュをクリアしてください。

### GitHub Pagesでの動作確認

アプリURL: `https://[username].github.io/mathmagic/`

数分待ってからアクセスしてください（GitHubの反映に時間がかかる場合があります）。

### ローカルでのテスト

```bash
# Pythonの場合
python -m http.server 8000

# Node.jsの場合
npx http-server
```

その後、`http://localhost:8000` でアクセス

---

**楽しく学んで、強くなろう！ 🎮📚**
