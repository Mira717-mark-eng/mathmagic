<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›³å½¢ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ - ãƒã‚¹ãƒã‚¸ï¼</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen p-8">

    <div class="max-w-4xl mx-auto">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-shapes text-purple-600 mr-3"></i>
                å›³å½¢ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
            </h1>
            <p class="text-gray-600">6ã¤ã®å•é¡Œã‚¿ã‚¤ãƒ—ã¨å‹•çš„ç”Ÿæˆã‚’ãƒ†ã‚¹ãƒˆ</p>
        </div>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-sliders-h text-blue-600 mr-2"></i>
                å•é¡Œç”Ÿæˆ
            </h2>

            <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                <button onclick="showProblem('angleUnderstanding', 'verticalAngles')"
                        class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸ“ å¯¾é ‚è§’
                </button>
                <button onclick="showProblem('angleUnderstanding', 'supplementaryAngles')"
                        class="bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸšª è£œè§’
                </button>
                <button onclick="showProblem('triangleRealLife', 'triangleAngles')"
                        class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸ”º ä¸‰è§’å½¢ã®è§’
                </button>
                <button onclick="showProblem('triangleRealLife', 'triangleTypes')"
                        class="bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸ” ä¸‰è§’å½¢æ¢åµ
                </button>
                <button onclick="showProblem('areaLogic', 'compareAreas')"
                        class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸ¯ é¢ç©æ¯”è¼ƒ
                </button>
                <button onclick="showProblem('areaLogic', 'triangleArea')"
                        class="bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸŒ» ä¸‰è§’å½¢é¢ç©
                </button>
                <button onclick="showProblem('geometryErrors', 'findMistake')"
                        class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    âŒ é–“é•ã„æ¢ã—
                </button>
                <button onclick="showProblem('geometryStructure', 'decomposeShape')"
                        class="bg-gradient-to-r from-teal-500 to-green-500 hover:from-teal-600 hover:to-green-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    âœ‚ï¸ å›³å½¢åˆ†è§£
                </button>
                <button onclick="showProblem('geometryStructure', 'triangleInRectangle')"
                        class="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105">
                    ğŸ“ é•·æ–¹å½¢ã®ä¸­
                </button>
            </div>

            <div class="flex gap-3">
                <button onclick="generateRandomProblem()"
                        class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-lg transition transform hover:scale-105">
                    <i class="fas fa-random mr-2"></i>
                    ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆ
                </button>
                <button onclick="generateBalancedSet()"
                        class="flex-1 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-bold py-3 px-6 rounded-lg transition transform hover:scale-105">
                    <i class="fas fa-list mr-2"></i>
                    ãƒãƒ©ãƒ³ã‚¹å‹15å•ç”Ÿæˆ
                </button>
            </div>
        </div>

        <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="bg-white rounded-2xl shadow-2xl p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-book text-green-600 mr-2"></i>
                å•é¡Œ
            </h2>

            <div id="problem-display" class="mb-6">
                <div class="text-center text-gray-400 py-12">
                    <i class="fas fa-arrow-up text-6xl mb-4"></i>
                    <p class="text-xl">ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰å•é¡Œã‚’é¸ã‚“ã§ã­ï¼</p>
                </div>
            </div>

            <!-- å›³å½¢è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="geometry-container" class="hidden">
                <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-4 mb-4">
                    <canvas id="geometry-canvas" width="600" height="400" class="mx-auto border-2 border-gray-300 rounded-lg bg-white"></canvas>
                </div>
            </div>

            <!-- å›ç­”ã‚¨ãƒªã‚¢ -->
            <div id="answer-area" class="hidden">
                <div class="bg-gray-50 rounded-xl p-4">
                    <div class="flex items-center justify-center space-x-3 mb-3">
                        <input
                            type="text"
                            id="answer-input"
                            class="text-2xl font-bold text-center w-48 px-4 py-3 border-4 border-purple-300 rounded-xl focus:border-purple-500 focus:outline-none focus:ring-4 focus:ring-purple-200"
                            placeholder="ç­”ãˆã‚’å…¥åŠ›"
                        >
                        <span id="unit-display" class="text-xl font-bold text-gray-600"></span>
                    </div>
                    <div class="text-center">
                        <button onclick="checkAnswer()" class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white text-lg font-bold px-8 py-3 rounded-full shadow-lg transition transform hover:scale-105">
                            <i class="fas fa-check-circle mr-2"></i>
                            ç­”ãˆã‚‹
                        </button>
                    </div>
                </div>
            </div>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="result-area" class="hidden mt-4">
                <!-- çµæœã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å•é¡Œã‚»ãƒƒãƒˆè¡¨ç¤º -->
        <div id="problem-set-display" class="hidden bg-white rounded-2xl shadow-2xl p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-clipboard-list text-orange-600 mr-2"></i>
                ç”Ÿæˆã•ã‚ŒãŸå•é¡Œã‚»ãƒƒãƒˆ
            </h2>
            <div id="problem-set-list" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- å•é¡Œãƒªã‚¹ãƒˆã¯JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/geometry-generator.js"></script>
    <script src="js/geometry-visualizer.js"></script>
    <script>
        let currentProblem = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;

        // GeometryVisualizerã‚’åˆæœŸåŒ–
        GeometryVisualizer.init('geometry-canvas');

        /**
         * ç‰¹å®šã®å•é¡Œã‚’è¡¨ç¤º
         */
        function showProblem(typeName, methodName) {
            console.log('å•é¡Œç”Ÿæˆ:', typeName, methodName);

            const typeObj = GeometryGenerator[typeName];
            if (!typeObj || typeof typeObj[methodName] !== 'function') {
                console.error('å•é¡Œã‚¿ã‚¤ãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', typeName, methodName);
                return;
            }

            currentProblem = typeObj[methodName]();
            currentQuestions = currentProblem.questions || [];
            currentQuestionIndex = 0;

            displayProblem(currentProblem);
        }

        /**
         * ãƒ©ãƒ³ãƒ€ãƒ ãªå•é¡Œã‚’ç”Ÿæˆ
         */
        function generateRandomProblem() {
            const types = ['angleUnderstanding', 'triangleRealLife', 'areaLogic', 'geometryErrors', 'geometryStructure'];
            const type = types[Math.floor(Math.random() * types.length)];
            const typeObj = GeometryGenerator[type];
            const methods = Object.keys(typeObj).filter(key => typeof typeObj[key] === 'function');
            const method = methods[Math.floor(Math.random() * methods.length)];

            showProblem(type, method);
        }

        /**
         * ãƒãƒ©ãƒ³ã‚¹å‹å•é¡Œã‚»ãƒƒãƒˆã‚’ç”Ÿæˆ
         */
        function generateBalancedSet() {
            const problems = GeometryGenerator.generateBalancedSet(15);
            console.log('ãƒãƒ©ãƒ³ã‚¹å‹å•é¡Œã‚»ãƒƒãƒˆç”Ÿæˆ:', problems.length, 'å•');

            displayProblemSet(problems);
        }

        /**
         * å•é¡Œã‚’è¡¨ç¤º
         */
        function displayProblem(problem) {
            const displayDiv = document.getElementById('problem-display');
            const geometryContainer = document.getElementById('geometry-container');
            const answerArea = document.getElementById('answer-area');
            const resultArea = document.getElementById('result-area');
            const problemSetDisplay = document.getElementById('problem-set-display');

            // å•é¡Œã‚»ãƒƒãƒˆè¡¨ç¤ºã‚’éš ã™
            problemSetDisplay.classList.add('hidden');

            // å•é¡Œæƒ…å ±ã‚’è¡¨ç¤º
            displayDiv.innerHTML = `
                <div class="mb-4">
                    <div class="inline-block bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-bold mb-2">
                        ${problem.category}
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">${problem.title}</h3>
                    <p class="text-lg text-gray-600 mb-4">${problem.story}</p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-2">
                        <p class="text-lg font-semibold text-blue-900">
                            <i class="fas fa-question-circle mr-2"></i>
                            ${currentQuestions[currentQuestionIndex]?.text || 'å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“'}
                        </p>
                    </div>
                    ${problem.learningPoint ? `
                    <div class="bg-green-50 border-l-4 border-green-500 p-3 mt-3">
                        <p class="text-sm font-semibold text-green-900">
                            <i class="fas fa-lightbulb mr-2"></i>
                            å­¦ç¿’ãƒã‚¤ãƒ³ãƒˆ: ${problem.learningPoint}
                        </p>
                    </div>
                    ` : ''}
                </div>
            `;

            // å›³å½¢ã‚’è¡¨ç¤º
            if (problem.visualizationType && problem.visualData) {
                geometryContainer.classList.remove('hidden');
                GeometryVisualizer.render(problem.visualizationType, problem.visualData);
            } else {
                geometryContainer.classList.add('hidden');
            }

            // å›ç­”ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            answerArea.classList.remove('hidden');
            document.getElementById('answer-input').value = '';
            document.getElementById('unit-display').textContent = '';

            // çµæœã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
            resultArea.classList.add('hidden');
            resultArea.innerHTML = '';
        }

        /**
         * å›ç­”ã‚’ãƒã‚§ãƒƒã‚¯
         */
        function checkAnswer() {
            const input = document.getElementById('answer-input').value.trim();
            const resultArea = document.getElementById('result-area');

            if (!input) {
                alert('ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const currentQuestion = currentQuestions[currentQuestionIndex];
            const userAnswer = input.toLowerCase().replace(/\s/g, '');
            const correctAnswer = String(currentQuestion.answer).toLowerCase().replace(/\s/g, '');

            const isCorrect = userAnswer === correctAnswer;

            // çµæœã‚’è¡¨ç¤º
            resultArea.classList.remove('hidden');
            resultArea.innerHTML = `
                <div class="bg-gradient-to-r ${isCorrect ? 'from-green-100 to-emerald-100 border-green-500' : 'from-red-100 to-pink-100 border-red-500'} border-l-4 p-4 rounded-lg">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-${isCorrect ? 'check-circle text-green-600' : 'times-circle text-red-600'} text-2xl mr-3"></i>
                        <span class="text-xl font-bold ${isCorrect ? 'text-green-800' : 'text-red-800'}">
                            ${isCorrect ? 'æ­£è§£ï¼' : 'ä¸æ­£è§£...'}
                        </span>
                    </div>
                    ${!isCorrect ? `
                    <p class="text-gray-700 mb-2">
                        æ­£è§£: <strong class="text-lg">${currentQuestion.answer}</strong>
                    </p>
                    ` : ''}
                    ${currentQuestion.explanation ? `
                    <p class="text-gray-700 text-sm">
                        <i class="fas fa-info-circle mr-1"></i>
                        ${currentQuestion.explanation}
                    </p>
                    ` : ''}
                    ${currentQuestionIndex < currentQuestions.length - 1 ? `
                    <button onclick="nextQuestion()" class="mt-3 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition">
                        <i class="fas fa-arrow-right mr-2"></i>æ¬¡ã®è³ªå•ã¸
                    </button>
                    ` : ''}
                </div>
            `;
        }

        /**
         * æ¬¡ã®è³ªå•ã¸
         */
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuestions.length) {
                displayProblem(currentProblem);
            }
        }

        /**
         * å•é¡Œã‚»ãƒƒãƒˆã‚’è¡¨ç¤º
         */
        function displayProblemSet(problems) {
            const problemSetDisplay = document.getElementById('problem-set-display');
            const problemSetList = document.getElementById('problem-set-list');

            problemSetDisplay.classList.remove('hidden');

            problemSetList.innerHTML = problems.map((problem, index) => `
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 border-2 border-purple-200 hover:border-purple-400 transition cursor-pointer" onclick="showGeneratedProblem(${index})">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-1">
                                <span class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm mr-3">
                                    ${index + 1}
                                </span>
                                <span class="font-bold text-gray-800">${problem.title}</span>
                            </div>
                            <p class="text-sm text-gray-600 ml-11">${problem.story}</p>
                        </div>
                        <div class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold">
                            ${problem.category}
                        </div>
                    </div>
                </div>
            `).join('');

            // ç”Ÿæˆã•ã‚ŒãŸå•é¡Œã‚’ä¿å­˜
            window.generatedProblems = problems;
        }

        /**
         * ç”Ÿæˆã•ã‚ŒãŸå•é¡Œã‚’è¡¨ç¤º
         */
        function showGeneratedProblem(index) {
            if (window.generatedProblems && window.generatedProblems[index]) {
                currentProblem = window.generatedProblems[index];
                currentQuestions = currentProblem.questions || [];
                currentQuestionIndex = 0;
                displayProblem(currentProblem);

                // å•é¡Œã‚»ãƒƒãƒˆè¡¨ç¤ºã‚’éš ã™
                document.getElementById('problem-set-display').classList.add('hidden');
            }
        }

        // åˆæœŸè¡¨ç¤º
        console.log('âœ… å›³å½¢ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†');
        console.log('GeometryGenerator:', GeometryGenerator);
        console.log('GeometryVisualizer:', GeometryVisualizer);
    </script>

</body>
</html>
