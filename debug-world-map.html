<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚° - ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 to-blue-900 p-8">

    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-2xl p-8 mb-6">
            <h1 class="text-3xl font-bold mb-6 text-gray-800">
                <i class="fas fa-bug mr-2 text-red-500"></i>
                ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ« - ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—
            </h1>

            <!-- ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
            <div class="bg-gray-100 rounded-lg p-4 mb-6">
                <h2 class="text-xl font-bold mb-4">ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <button onclick="createTestPlayer(1)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦1å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(2)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦2å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(3)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦3å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(4)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦4å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(5)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦5å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(6)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">å°å­¦6å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(7)" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">ä¸­å­¦1å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(8)" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">ä¸­å­¦2å¹´ç”Ÿ</button>
                    <button onclick="createTestPlayer(9)" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">ä¸­å­¦3å¹´ç”Ÿ</button>
                </div>
                <div class="mt-4">
                    <button onclick="showCurrentPlayer()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded mr-2">ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±è¡¨ç¤º</button>
                    <button onclick="clearData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
                </div>
            </div>

            <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±è¡¨ç¤º -->
            <div id="player-info" class="bg-blue-50 rounded-lg p-4 mb-6 hidden">
                <h3 class="text-lg font-bold mb-2">ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
                <pre id="player-data" class="bg-white p-4 rounded overflow-auto text-sm"></pre>
            </div>

            <!-- ãƒ¯ãƒ¼ãƒ«ãƒ‰æƒ…å ±è¡¨ç¤º -->
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="text-lg font-bold mb-2">åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ãƒ«ãƒ‰</h3>
                <div id="available-worlds" class="bg-white p-4 rounded">
                    <p class="text-gray-500">ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                </div>
            </div>
        </div>

        <!-- ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—ã¸ã®ãƒªãƒ³ã‚¯ -->
        <div class="text-center">
            <a href="world-map.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-lg text-xl font-bold shadow-lg">
                <i class="fas fa-map mr-2"></i>
                ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ—ã‚’é–‹ã
            </a>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <script src="js/player.js"></script>
    <script src="js/worlds.js"></script>

    <script>
        // ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
        function createTestPlayer(grade) {
            const gradeNames = ['', 'å°1', 'å°2', 'å°3', 'å°4', 'å°5', 'å°6', 'ä¸­1', 'ä¸­2', 'ä¸­3'];
            const testPlayer = {
                id: 'test-' + Date.now(),
                name: `ãƒ†ã‚¹ãƒˆ${gradeNames[grade]}`,
                grade: grade,
                characterType: 'wizard',
                level: 10,  // ãƒ¬ãƒ™ãƒ«10ã«å¤‰æ›´ï¼ˆã™ã¹ã¦ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰
                exp: 0,
                totalProblems: 0,
                correctProblems: 0,
                consecutiveCorrect: 0,
                consecutiveWrong: 0,
                currentDifficulty: 'normal',
                weakAreas: [],
                inventory: [],
                equipment: {},
                completedWorlds: [],
                createdAt: new Date().toISOString(),
                lastPlayedAt: new Date().toISOString()
            };

            MathMagic.setItem('currentPlayer', testPlayer);
            console.log('ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ:', testPlayer);

            MathMagic.showMessage(`${gradeNames[grade]}ã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸ`, 'success');

            showCurrentPlayer();
            showAvailableWorlds();
        }

        // ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
        function showCurrentPlayer() {
            const player = MathMagic.getCurrentPlayer();
            const playerInfo = document.getElementById('player-info');
            const playerData = document.getElementById('player-data');

            if (player) {
                playerInfo.classList.remove('hidden');
                playerData.textContent = JSON.stringify(player, null, 2);
            } else {
                playerInfo.classList.add('hidden');
                MathMagic.showMessage('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
            }
        }

        // åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚’è¡¨ç¤º
        function showAvailableWorlds() {
            const player = MathMagic.getCurrentPlayer();
            const container = document.getElementById('available-worlds');

            if (!player) {
                container.innerHTML = '<p class="text-gray-500">ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>';
                return;
            }

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å­¦å¹´ã«åˆã£ãŸãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—
            const availableWorlds = WORLD_DATABASE.filter(world => {
                // targetGradeãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’å„ªå…ˆã€ãªã‘ã‚Œã°minGrade/maxGradeã‚’ä½¿ç”¨
                if (world.targetGrade) {
                    return player.grade === world.targetGrade;
                }
                return player.grade >= world.minGrade && player.grade <= world.maxGrade;
            });

            console.log(`${player.grade}å¹´ç”Ÿå‘ã‘ãƒ¯ãƒ¼ãƒ«ãƒ‰:`, availableWorlds.length, 'å€‹');
            console.log('åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ãƒ«ãƒ‰:', availableWorlds);

            if (availableWorlds.length === 0) {
                container.innerHTML = `
                    <p class="text-red-500 font-bold">âš ï¸ ${player.grade}å¹´ç”Ÿå‘ã‘ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                    <p class="text-sm text-gray-600 mt-2">worlds.jsã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>
                `;
            } else {
                let html = `<p class="font-bold mb-2">${availableWorlds.length}å€‹ã®ãƒ¯ãƒ¼ãƒ«ãƒ‰ãŒåˆ©ç”¨å¯èƒ½ã§ã™:</p><ul class="space-y-2">`;
                availableWorlds.forEach(world => {
                    const isLocked = player.level < world.requiredLevel;
                    html += `
                        <li class="border-b pb-2">
                            <div class="flex items-center justify-between">
                                <span>
                                    <span class="text-2xl mr-2">${world.icon}</span>
                                    <strong>${world.name}</strong>
                                    ${isLocked ? '<span class="text-red-500">ğŸ”’</span>' : '<span class="text-green-500">âœ“</span>'}
                                </span>
                                <span class="text-sm text-gray-600">
                                    é›£æ˜“åº¦: ${'â­'.repeat(world.difficulty)} | å¿…è¦Lv: ${world.requiredLevel}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 ml-10">${world.description}</p>
                        </li>
                    `;
                });
                html += '</ul>';
                container.innerHTML = html;
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearData() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.clear();
                MathMagic.showMessage('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
                document.getElementById('player-info').classList.add('hidden');
                document.getElementById('available-worlds').innerHTML = '<p class="text-gray-500">ãƒ†ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>';
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ãƒ‡ãƒãƒƒã‚°ãƒšãƒ¼ã‚¸åˆæœŸåŒ–');
            const player = MathMagic.getCurrentPlayer();
            if (player) {
                showCurrentPlayer();
                showAvailableWorlds();
            }
        });
    </script>
</body>
</html>
