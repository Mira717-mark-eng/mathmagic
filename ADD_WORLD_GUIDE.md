# 新ワールド追加ガイド

このガイドでは、マスマジ！に新しいワールドを追加する手順を説明します。

---

## 📝 必要な情報

新ワールドを追加する前に、以下の情報を決定してください：

1. **ワールド名** - 例: "方程式の迷宮"
2. **説明** - 短い説明文
3. **アイコン** - 絵文字（例: 🏰）
4. **対象学年範囲** - minGrade〜maxGrade
5. **ターゲット学年** - 最も適した学年
6. **難易度** - 1〜5の数値
7. **必要レベル** - 解放に必要なレベル
8. **数学分野** - 掛け算、分数、方程式など

---

## 🛠️ 実装手順

### ステップ1: `js/worlds.js` にワールド定義を追加

```javascript
{
    // 基本情報
    id: 'equation_maze',                    // 一意のID（英数字とアンダースコア）
    name: '方程式の迷宮',                    // 表示名
    description: '一次方程式の謎を解く',     // 短い説明
    icon: '🏰',                             // アイコン絵文字
    
    // 学年設定
    minGrade: 6,                           // 最小学年（小6）
    maxGrade: 9,                           // 最大学年（中3）
    targetGrade: 7,                        // ターゲット学年（中1）
    
    // 難易度・レベル
    difficulty: 3,                         // 難易度（1-5の星）
    requiredLevel: 5,                      // 解放レベル
    
    // AI生成設定
    aiGeneration: {
        enabled: true,                     // AI生成を有効化
        
        // AI問題生成プロンプト
        prompt: `
小学6年生〜中学1年生向けの一次方程式問題を生成してください。

要件:
- x + 3 = 7 のような基本的な一次方程式
- 答えは整数
- ストーリー: 迷宮を探索する冒険者のテーマ
- 子供向けの楽しい表現

出力形式（JSON）:
{
  "story": "迷宮の扉に方程式が刻まれている...",
  "question": "x + 3 = 7",
  "answer": "4",
  "unit": "",
  "hints": [
    "両辺から3を引いてみよう",
    "x = 7 - 3 を計算しよう",
    "答えは4だよ"
  ]
}
        `,
        
        // 例題（AIプロンプトの参考用）
        examples: [
            'x + 5 = 12',
            'x - 3 = 8',
            '2x = 14'
        ]
    },
    
    // フォールバック問題（AI失敗時）
    fallbackProblems: [
        {
            story: '迷宮の扉に方程式が刻まれている。「x + 5 = 12」この謎を解いて進もう！',
            question: 'x + 5 = 12',
            answer: 7,
            unit: '',
            hints: [
                '両辺から5を引いてみよう',
                'x = 12 - 5 を計算しよう',
                '答えは7だよ'
            ]
        },
        {
            story: '宝箱の鍵に「x - 3 = 8」と書かれている。xの値がわかれば開けられるぞ！',
            question: 'x - 3 = 8',
            answer: 11,
            unit: '',
            hints: [
                '両辺に3を足してみよう',
                'x = 8 + 3 を計算しよう',
                '答えは11だよ'
            ]
        }
    ],
    
    // 図形表示設定（必要な場合）
    figureSettings: {
        enabled: false,                    // 図形が必要ならtrue
        type: null                         // 'rectangle', 'circle', 'triangle' など
    }
}
```

### ステップ2: `WORLD_DATABASE` 配列に追加

`js/worlds.js` の `WORLD_DATABASE` 配列の最後に追加：

```javascript
const WORLD_DATABASE = [
    {
        id: 'multiplication_forest',
        // ... 既存のワールド
    },
    {
        id: 'division_cave',
        // ... 既存のワールド
    },
    // 👇 ここに新ワールドを追加
    {
        id: 'equation_maze',
        name: '方程式の迷宮',
        // ... 上記の定義をコピー
    }
];
```

### ステップ3: 動作確認

1. ブラウザでワールドマップを開く
2. 対象学年のプレイヤーでログイン
3. 新ワールドが表示されることを確認
4. ワールドに入って問題が生成されることを確認

---

## 🎨 AIプロンプトのカスタマイズ

### 良いプロンプトの条件

1. **明確な対象学年**
   ```
   小学3年生向けの掛け算問題を生成してください。
   ```

2. **具体的な問題範囲**
   ```
   2桁 × 1桁の掛け算（10〜99 × 1〜9）
   ```

3. **ストーリーテーマ**
   ```
   ストーリー: 森の魔法使いがクイズを出すテーマ
   ```

4. **子供向けの言葉遣い**
   ```
   難しい言葉は使わず、楽しい表現で
   ```

5. **明確な出力形式**
   ```json
   {
     "story": "...",
     "question": "...",
     "answer": "...",
     "unit": "..."
   }
   ```

### プロンプト例集

#### 掛け算ワールド
```
小学2〜3年生向けの九九問題を生成してください。

要件:
- 1桁 × 1桁の掛け算（1〜9 × 1〜9）
- 答えは81以下
- ストーリー: 森の動物たちが助けを求めている
- 「〜匹」「〜個」などの単位を使う
```

#### 分数ワールド
```
小学5〜6年生向けの分数の足し算問題を生成してください。

要件:
- 分母が同じ分数の足し算（例: 1/4 + 2/4）
- 答えは帯分数または仮分数
- ストーリー: 塔を登るストーリー
- 分数は分子/分母の形式で表記
```

#### 面積ワールド
```
小学4〜5年生向けの長方形の面積問題を生成してください。

要件:
- 縦と横の長さから面積を求める
- 縦・横は1〜20の整数（cm単位）
- ストーリー: 広場で遊ぶストーリー
- 図形データを含める

出力形式:
{
  "story": "...",
  "question": "縦5cm、横8cmの長方形の面積は？",
  "answer": "40",
  "unit": "cm²",
  "figure": {
    "type": "rectangle",
    "width": 8,
    "height": 5
  }
}
```

---

## 🖼️ 図形付き問題の作成

図形を表示する問題の場合：

### 1. ワールド定義で図形を有効化

```javascript
figureSettings: {
    enabled: true,
    type: 'rectangle'  // または 'circle', 'triangle' など
}
```

### 2. AIプロンプトに図形指示を追加

```javascript
prompt: `
図形の面積問題を生成してください。

出力形式（JSON）:
{
  "story": "...",
  "question": "...",
  "answer": "...",
  "unit": "cm²",
  "figure": {
    "type": "rectangle",
    "width": 数値,
    "height": 数値
  }
}
`
```

### 3. 対応する図形タイプ

- `rectangle` - 長方形
- `square` - 正方形
- `circle` - 円
- `triangle` - 三角形
- `lshape` - L字型
- `barChart` - 棒グラフ
- `lineChart` - 折れ線グラフ

---

## 🧪 テスト方法

### 1. ブラウザのコンソールでテスト

```javascript
// ワールドデータを確認
console.log(WORLD_DATABASE);

// 特定のワールドを検索
const myWorld = WORLD_DATABASE.find(w => w.id === 'equation_maze');
console.log(myWorld);
```

### 2. AI生成をテスト

1. ワールドに入る
2. ブラウザのコンソールを開く（F12）
3. AI生成のログを確認
4. エラーがないか確認

### 3. フォールバック問題をテスト

1. 意図的にAPIキーを無効化
2. ワールドに入る
3. フォールバック問題が表示されることを確認

---

## 💡 ヒント

### 学年別のワールド数の目安

- **小学1〜2年**: 3〜5ワールド
- **小学3〜4年**: 5〜8ワールド
- **小学5〜6年**: 8〜10ワールド
- **中学1〜3年**: 10〜15ワールド

### 難易度設定の目安

- **難易度1（⭐）**: 基礎の基礎
- **難易度2（⭐⭐）**: 基礎
- **難易度3（⭐⭐⭐）**: 標準
- **難易度4（⭐⭐⭐⭐）**: 応用
- **難易度5（⭐⭐⭐⭐⭐）**: 発展・入試レベル

### 必要レベルの目安

- **requiredLevel: 1**: 誰でも挑戦可能
- **requiredLevel: 3**: 少し経験が必要
- **requiredLevel: 5**: 基礎を固めてから
- **requiredLevel: 10**: かなりの練習が必要

---

## 📚 参考資料

- **[CURRICULUM_RESEARCH.md](./CURRICULUM_RESEARCH.md)** - 学年別カリキュラム
- **[WORLD_DESIGN.md](./WORLD_DESIGN.md)** - ワールド設計の詳細
- **[js/worlds.js](./js/worlds.js)** - 既存ワールドの実装例

---

## 🎉 完成後

新ワールドを追加したら：

1. ✅ 動作確認
2. ✅ README.mdの「実装済みワールド」セクションを更新
3. ✅ Gitにコミット（GitHubを使用している場合）
4. ✅ Netlifyに再デプロイ

Happy World Building! 🎮✨
